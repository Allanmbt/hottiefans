import{E as e,c as t,o,d as n,w as l,e as s,n as a,m as r,h as i,t as u,i as c,q as f,f as d,p as g,r as p,I as h}from"./index-DyB-GtSf.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{c as w,g as T}from"./system.Bdz65IDa.js";import{a as S}from"./element.B9OwrRfy.js";const m=y({__name:"n-refresher",props:{mainText:{type:String,default:"下拉即可刷新..."},pullingText:{type:String,default:"释放即可刷新..."},refreshingText:{type:String,default:"正在努力加载..."},refreshing:{type:Boolean,default:!1},couldUnLash:{type:Boolean,default:!1},rate:{type:Number,default:0},boxStyle:{type:String,default:""},textStyle:{type:String,default:""},boxClass:{type:String,default:""},textClass:{type:String,default:""}},setup(d){e(140);const g=d,p=t((()=>g.refreshing?g.refreshingText:h.value)),h=t((()=>g.couldUnLash?g.pullingText:g.mainText)),y=t((()=>`transition-property: transform; transition-duration: 300ms; transform: rotateZ(${g.rate>=1?"360deg":360*g.rate+"deg"});`)),w=t((()=>g.rate>.4?"opacity: 1;":"opacity: 0;"));return(e,t)=>{const g=c,h=f;return o(),n(g,{class:a([d.boxClass||"n-refresher","n-flex-row","n-justify-center"]),style:r(d.boxStyle||"width:750rpx;")},{default:l((()=>[s(g,{class:a(["n-cycle-container",d.refreshing&&"n-scroll-rotate"])},{default:l((()=>[s(g,{class:"n-u-cover n-u-c2",style:r(y.value)},{default:l((()=>[s(g,{class:"n-u-cover-cycle",style:r(w.value)},null,8,["style"])])),_:1},8,["style"])])),_:1},8,["class"]),s(h,{class:a([d.textClass||"n-u-txt"]),style:r(d.textStyle)},{default:l((()=>[i(u(p.value),1)])),_:1},8,["class","style"])])),_:1},8,["class","style"])}}},[["__scopeId","data-v-c0be89f7"]]),v={__name:"n-loader",props:{mainText:{type:String,default:"继续加载更多"},loadingText:{type:String,default:"正在加载"},noMoreText:{type:String,default:"没有更多啦"},isLoading:{type:Boolean,default:!1},loadingSrc:{type:String,default:"/static/ui/loading-small.gif"},hasMore:{type:Boolean,default:!0},showNoMore:{type:Boolean,default:!0},flex:{type:String,default:"column"},boxStyle:{type:String,default:""},imgStyle:{type:String,default:""},textStyle:{type:String,default:""},boxClass:{type:String,default:""},imgClass:{type:String,default:""},textClass:{type:String,default:""}},setup(e){const p=e,h=t((()=>p.hasMore?p.isLoading?p.loadingText:p.mainText:p.noMoreText));return(t,p)=>{const y=g,w=f,T=c;return o(),n(T,{class:a([e.boxClass||"n-loader","n-flex-"+e.flex,"n-align-center","n-justify-center"]),style:r(e.boxStyle)},{default:l((()=>[e.hasMore&&e.isLoading?(o(),n(T,{key:0,class:"n-flex-column n-align-center"},{default:l((()=>[s(y,{class:a([e.imgClass||"n-loader-img"]),src:e.loadingSrc,mode:"aspectFill",style:r(e.imgStyle)},null,8,["class","src","style"]),s(w,{class:a([e.textClass||"n-loader-text"]),style:r(e.textStyle)},{default:l((()=>[i(u(h.value),1)])),_:1},8,["class","style"])])),_:1})):d("",!0),!e.hasMore&&e.showNoMore?(o(),n(w,{key:1,class:a([e.textClass||"n-loader-text"]),style:r(e.textStyle)},{default:l((()=>[i(u(h.value),1)])),_:1},8,["class","style"])):d("",!0)])),_:1},8,["class","style"])}}};function x(){const e=p(null),t=p(0);return{nCurrentView:e,nScrollTop:t,nScrollTo:function(o,n={offset:0,animated:!0}){"string"!=typeof o?(e.value=null,t.value===o?t.value=o+.1:t.value=o):e.value=o},nScrollToTop:function(t,o={offset:0,animated:!0}){e.value="nlisttop"},nScrollToBottom:function(t,o={offset:0,animated:!0}){e.value="nlistbottom"}}}function P(e){return{onScrollToUpper:function(t){e("upper",t)},onScrollToLower:function(t){e("lower",t)},onRefresherPulling:function(t){e("pulling",t)},onRefresherRefresh:function(t){e("refresh",t)},onRefresherRestore:function(t){e("restore",t)},onRefresherAbort:function(t){e("abort",t)}}}function D(o,n,l,s,a,r,i){w();const u=h({isDownLoading:!1,isUpLoading:!1,down:{use:!0,offset:e(140),inRate:.8,outRate:.2},up:{use:!0,offset:80},hasMore:!0,currentPage:0,prePage:0,scrollable:!0,downHeight:0,startPoint:null,lastPoint:null,theScrollHeight:0,theScrollTop:0,startTop:0,inTouchend:!1,preScrollY:0,fps:40,moveTime:0,moveTimeDiff:0,scrollTopDeviation:100,isMoveDown:!1,downMoveType:0,isDownReset:!1}),c=t((()=>T(o.height)));function f(){u.prePage=u.currentPage,u.currentPage=1,g("refresh")}function d(){u.prePage=u.currentPage,u.currentPage+=1,g("load")}function g(e="refresh"){n("refresh"===e?"down":"up",u.currentPage)}function p(){u.scrollable=!0,u.isDownReset=!0,u.isDownLoading=!1,u.downHeight=0}function y(){if(u.isDownLoading||u.isUpLoading||!u.hasMore||!u.up.use)return;let e=!1;(function(){let e=c.value;u.theScrollHeight>0&&(e=u.theScrollHeight);return e-u.theScrollTop-c.value})()<=u.up.offset&&(e=!0),e&&(u.isUpLoading=!0,d())}function m(){u.isUpLoading=!1}return{pagerState:u,nInitContentList:function(){u.prePage=0,u.currentPage=1,g("refresh")},nScroll:function(e){n("scroll",e),u.theScrollTop=e.detail.scrollTop,u.theScrollHeight=e.detail.scrollHeight;const t=e.detail.scrollTop-u.preScrollY>0;u.preScrollY=e.detail.scrollTop,t&&y(),r.value&&(r.value=null)},nRefresh:f,nReload:function(){u.prePage=u.currentPage,u.currentPage=1,g("load")},nLoad:d,nEndSuccess:function(e=!1){u.hasMore=e||!1,u.isDownLoading&&p(),u.isUpLoading&&m()},nEndError:function(){u.currentPage=u.prePage,u.isDownLoading&&p(),u.isUpLoading&&m()},nTouchstartEvent:function(e){o.isChild&&!u.scrollable||(u.startPoint=S(e),u.startTop=u.theScrollTop||0,u.lastPoint=u.startPoint,u.inTouchend=!1)},nTouchmoveEvent:function(e){if(o.isChild&&!u.scrollable)return;if(!u.down.use&&!o.isChild)return;if(!u.startPoint)return;const t=(new Date).getTime();if(u.moveTime&&t-u.moveTime<u.moveTimeDiff)return;u.moveTime=t,u.moveTimeDiff=1e3/u.fps;const l=u.theScrollTop,s=S(e);if(s.y-u.startPoint.y>0&&(l<=0||l<=u.scrollTopDeviation&&l<=u.startTop)){i.value=0==i.value?.01:0;const e=s.y-u.lastPoint.y;if(o.isChild)return u.downHeight+=e,n("move",u.downHeight),void(u.lastPoint=s);if(!u.inTouchend&&!u.isDownLoading&&!u.isUpLoading){u.downHeight<u.down.offset?(1!==u.downMoveType&&(u.downMoveType=1,u.scrollable=!1,u.isDownReset=!1,u.isDownLoading=!1,u.isMoveDown=!0),u.downHeight+=e*u.down.inRate):(2!==u.downMoveType&&(u.downMoveType=2,u.scrollable=!1,u.isDownReset=!1,u.isDownLoading=!1,u.isMoveDown=!0),u.downHeight+=e>0?Math.round(e*u.down.outRate):e);u.downHeight,u.down.offset;u.downHeight}}u.lastPoint=s},nTouchendEvent:function(e){if((!o.isChild||u.scrollable)&&u.startPoint){if(u.isMoveDown)i.value=0==i.value?.01:0,u.downHeight>=u.down.offset?(u.scrollable=!0,u.isDownReset=!0,u.isDownLoading=!0,u.downHeight=u.down.offset,f()):(u.downHeight=0,p()),u.downMoveType=0,u.isMoveDown=!1;else if(u.theScrollTop===u.startTop){S(e).y-u.startPoint.y<0&&y()}console.log("end dh",u.downHeight)}}}}export{m as _,D as a,v as b,P as c,x as u};
