import{r as t,c as a,K as e,a2 as o,d as n,w as i,i as l,o as s,n as r,H as u,m as p,N as v,f,e as c}from"./index-DyB-GtSf.js";import{m}from"./props.CkprGx8I.js";import{a as y}from"./element.B9OwrRfy.js";import{g as h,b as d}from"./system.Bdz65IDa.js";const x={__name:"n-drawer",props:m([["pos","bottom"],"bgType",["duration",300],["auto",!0],["allowAll",!0],["allowSwipe",!0],["onlySwipe",!1],["hasOverlay",!0],["overlay",{timingFunction:["ease-in","ease-out"],duration:300,bg:"",bgType:"mask"}],["baseHeight","screen"],["height","0"],["standout","0"],["leftOffset","-1"],["rightOffset","-1"],["bottomOffset","-1"],["topOffset","-1"],["baseWidth","750rpx"],["width","750rpx"],["animation",{timingFunction:"ease-in-out"}],["initWithAni",!0],["initDelay",200],["initDuration",300],["left","0"],["right","0"],["top","0"],["bottom","0"],["openRate",.5],["closeRate",.5],["delay",150],"overlayStyle","boxStyle","overlayClass","boxClass"]),emits:["start","end","overlayClicked","open","close"],setup(m,{expose:x,emit:g}){const b=m,$=g;x({show:function(t){it(!0,void 0===t&&b.duration)},hide:function(t){it(!1,void 0===t&&b.duration)}});const O=t(""),w=t(""),k=t(!1),T=t(0),_=t(null);t(null),t(null);const C=t(null),A=t(null),X=t(null),Y=a((()=>h(b.baseHeight))),F=a((()=>d(b.baseWidth))),S=a((()=>Y.value-q.value-E.value)),D=a((()=>`left:${N.value}px;top:${q.value}px;right:${B.value}px;`+b.overlayStyle)),j=a((()=>{let t={width:`${R.value}px`,height:`${P.value}px`};"top"!==b.pos&&"bottom"!==b.pos||(H.value<0&&z.value<0?t.left=.5*(F.value-N.value-B.value-R.value)+"px":H.value>=0?t.left=N.value+H.value+"px":z.value>=0&&(t.right=B.value+z.value+"px"),t[b.pos]=-P.value+"px"),"left"!==b.pos&&"right"!==b.pos||(M.value<0&&K.value<0?t.top=.5*(Y.value-q.value-E.value-P.value)+"px":M.value>=0?t.top=q.value+M.value+"px":K.value>=0&&(t.bottom=E.value+K.value+"px"),t[b.pos]=-R.value+"px");let a="";for(const e in t)a+=e+":"+t[e]+";";return a})),P=a((()=>{const t=h(b.height);return t>1?t:t<=0?Y.value-q.value-E.value-(M.value>=0?M.value:0)-(K.value>=0?K.value:0):Y.value*t})),R=a((()=>{const t=d(b.width);return t<=0?F.value-N.value-B.value-(H.value>=0?H.value:0)-(z.value>=0?z.value:0):t})),W=a((()=>h(b.standout))),H=a((()=>"-1"===b.leftOffset?-1:d(b.leftOffset))),M=a((()=>"-1"===b.topOffset?-1:h(b.topOffset))),z=a((()=>"-1"===b.rightOffset?-1:d(b.rightOffset))),K=a((()=>"-1"===b.bottomOffset?-1:h(b.bottomOffset))),N=a((()=>d(b.left))),q=a((()=>h(b.top))),B=a((()=>d(b.right))),E=a((()=>h(b.bottom)));function G(){let t=0;b.initWithAni&&(t=b.initDuration||0),w.value=`transition-property: transform;transition-duration:${t}ms;transition-timing-function: ${b.animation.timingFunction};transform:translate${"top"==b.pos||"bottom"==b.pos?"Y":"X"}(${"top"==b.pos||"left"==b.pos?W.value:-1*W.value}px);`}function I(t){b.allowAll&&at(t)}function J(t){b.allowAll&&et(t)}function L(t){b.allowAll&&ot(t)}function Q(t){b.allowAll&&nt()}function U(t){at(t)}function V(t){et(t)}function Z(t){ot(t)}function tt(t){nt()}function at(t){$("start"),_.value=y(t)}function et(t){if(!_.value)return;const a=y(t),e=st(b.pos,!1),o=e-W.value;let n=a.y-_.value.y,i=a.x-_.value.x;if(b.auto||(n+=T.value,i+=T.value),k.value){if("top"===b.pos){if(n<=0){const t=-n+W.value>=e?W.value:e+n;w.value=`transition-property: transform; transform: translateY(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(t-W.value)/o};height:${S.value}px;`)}}else if("bottom"===b.pos)if(n<=0);else{const t=n+W.value>=e?-W.value:-e+n;w.value=`transition-property: transform; transform: translateY(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(-t-W.value)/o};height:${S.value}px;`)}else if("left"===b.pos){if(i<=0){const t=-i+W.value>=e?W.value:i+e;w.value=`transition-property: transform; transform: translateX(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(t-W.value)/o};height:${S.value}px;`)}}else if("right"===b.pos&&i>0){const t=i+W.value>=e?-W.value:i-e;w.value=`transition-property: transform; transform: translateX(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(-t-W.value)/o};height:${S.value}px;`)}}else if("top"===b.pos){if(n>0){n+=W.value;const t=n>=e?e:n;w.value=`transition-property: transform; transform: translateY(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(t-W.value)/o};height:${S.value}px;`)}}else if("bottom"===b.pos)if(n>=0);else{n+=-1*W.value;const t=-n>=e?-1*e:n;w.value=`transition-property: transform; transform: translateY(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(-t-W.value)/o};height:${S.value}px;`)}else if("left"===b.pos){if(i>0){i+=W.value;const t=i>=e?e:i;w.value=`transition-property: transform; transform: translateX(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(t-W.value)/o};height:${S.value}px;`)}}else if("right"===b.pos&&i<0){i+=-1*W.value;const t=-i>=e?-1*e:i;w.value=`transition-property: transform; transform: translateX(${t}px); transition-duration: 0ms;`,b.hasOverlay&&(O.value=`transition-property:opacity; transition-duration: 0ms;opacity:${(-t-W.value)/o};height:${S.value}px;`)}}function ot(t){if(console.log("touchend"),!_.value)return;const a=y(t),e=st(b.pos,!1)-W.value,o=b.openRate*e,n=b.closeRate*e,i=a.y-_.value.y,l=Math.abs(i);if(l<1)return;const s=a.x-_.value.x,r=Math.abs(s);if(!b.auto){let t=T.value+("bottom"===b.pos||"top"===b.pos?i:s);return"bottom"===b.pos||"right"===b.pos?t>=0?t=0:-1*t>=e&&(t=-1*e):"left"!==b.pos&&"top"!==b.pos||(t<=0?t=0:t>=e&&(t=e)),T.value=t,void $("end",{offset:T.value,max:e})}if(k.value){if("bottom"===b.pos||"top"===b.pos){if(l>=n){if("top"===b.pos&&i<0)return void it(!1);if("bottom"===b.pos&&i>0)return void it(!1)}it(!0)}else if("left"===b.pos||"right"===b.pos){if(r>=n){if("left"===b.pos&&s<0)return void it(!1);if("right"===b.pos&&s>0)return void it(!1)}it(!0)}}else if("bottom"===b.pos||"top"===b.pos){if(l>=o){if("top"===b.pos&&i>0)return void it(!0);if("bottom"===b.pos&&i<0)return void it(!0)}it(!1)}else if("left"===b.pos||"right"===b.pos){if(r>=o){if("left"===b.pos&&s>0)return void it(!0);if("right"===b.pos&&s<0)return void it(!0)}it(!1)}}function nt(t){it(!1)}function it(t){!function(t,a=b.duration){!function(t,a=b.duration){k.value=t;let e="transition-duration:"+a+"ms;";e+="transition-timing-function:"+b.animation.timingFunction+";",e+="transition-property:transform;",e+="transform:"+function(t,a){let e=st(t,a),o="";switch(t){case"top":o=`translateY(${e}px)`;break;case"bottom":o=`translateY(-${e}px)`;break;case"left":o=`translateX(${e}px)`;break;case"right":o=`translateX(-${e}px)`}return o}(b.pos,!t)+";",w.value=e,setTimeout((()=>{$(t?"open":"close")}),a);let o="transition-duration:"+b.overlay.duration+"ms;";t&&(o+=`height:${S.value}px;`),o+="transition-timing-function:"+(t?b.overlay.timingFunction[0]:b.overlay.timingFunction[1])+";",o+="transition-property:opacity;",o+="opacity:"+(t?1:0)+";",O.value=o,setTimeout((()=>{!t&&(O.value="")}),b.overlay.duration)}(t,a)}(t)}function lt(t){t.stopPropagation&&t.stopPropagation(),k.value&&$("overlayClicked",{})}function st(t,a){let e=W.value;switch(t){case"top":a||(e=P.value+q.value+(M.value>=0?M.value:0));break;case"bottom":a||(e=P.value+E.value+(K.value>=0?K.value:0));break;case"left":a||(e=R.value+N.value+(H.value>=0?H.value:0));break;case"right":a||(e=R.value+B.value+(z.value>=0?z.value:0))}return e}function rt(t){t.stopPropagation&&t.stopPropagation()}return e((()=>{b.initDelay>=0?setTimeout((()=>{G()}),b.initDelay):G()})),o((()=>{})),(t,a)=>{const e=l;return s(),n(e,{bubble:"true"},{default:i((()=>[t.hasOverlay?(s(),n(e,{key:0,ref_key:"npopooverlay",ref:C,class:r(["n-position-fixed","n-zindex-drawer-overlay","n-opacity-0","n-height-0","n-bg-"+t.overlay.bgType,t.overlayClass]),onClick:u(lt,["stop"]),style:p(D.value+O.value)},{default:i((()=>[v(t.$slots,"overlay")])),_:3},8,["class","style"])):f("",!0),c(e,{ref_key:"npopo",ref:A,bubble:"true",onTouchstart:I,onTouchmove:J,onTouchcancel:Q,onTouchend:L,onClick:u(rt,["stop"]),class:r(["n-position-fixed","n-zindex-drawer","n-width-750rpx","n-flex-column","n-bg-"+t.bgType,t.boxClass]),style:p(t.boxStyle+j.value+w.value)},{default:i((()=>[t.allowAll?f("",!0):(s(),n(e,{key:0,ref_key:"npopostand",ref:X,onTouchstart:U,onTouchmove:V,onTouchcancel:tt,onTouchend:Z,onClick:u(rt,["stop"])},{default:i((()=>[v(t.$slots,"standout")])),_:3},512)),v(t.$slots,"default")])),_:3},8,["class","style"])])),_:3})}}};export{x as _};
