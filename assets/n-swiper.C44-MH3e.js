import{a3 as e,r as t,c as n,d as a,w as i,j as l,n as r,m as s,i as u,o,N as c,a4 as v,a5 as d,K as p,J as m,a2 as h}from"./index-DyB-GtSf.js";import{m as x}from"./props.CkprGx8I.js";import{u as f}from"./element.B9OwrRfy.js";import{b as g}from"./system.Bdz65IDa.js";const y={__name:"n-swiper-item",props:x(["bgType","border","radius",["flex","column"],["justify","start"],["align","start"],"boxStyle","boxClass"]),setup(v){const d=e("nSwiper"),p=t(0),m=f();p.value=d.children.length,d.pushChild({index:p,nswiperitem:m,getExp:function(e,t=1){const n=d.baseWidthPx.value;let a=-e*n;const i=p.value;if(d.children.length,d.circular.value&&(a=g(n,e,i,!0),""===a))return"0+"+5*n;const l=d.maxX.value,r=`(abs(x*${t}) >= ${l} ? (x>0?${l}:(${-1*l})) : (x*${t}))`;if(d.linear.value)return`${r}+${a}`;return`abs(sin(${1.57/l}*${r}))*${r}+${a}`},getScaleExp:function(e,t=1){const n=`${d.scale.value}+0`,a=d.baseWidthPx.value,i=`max(1 - abs(x*${t}/${a}), ${d.scale.value})`,l=`min(1, ${d.scale.value}+abs(x*${t}/${a}))`,r=d.circular.value,s=p.value,u=d.children.length;let o=n;e===s?o=i:(e-1===s?o=`x>=0?${l}:${n}`:e+1===s&&(o=`x>=0?${n}:${l}`),r&&(0===e&&s===u-1?o=`x>=0?${l}:${n}`:e===u-1&&0===s&&(o=`x>=0?${n}:${l}`)));return o},toAdjust:function(e,t,n){const a=d.inCurrent.value,i=d.circular.value,l=d.children.length,r=p.value;let s=d.duration.value;const u=d.baseWidthPx.value;let o=d.scale.value;const c=d.percent.value;let v=Math.abs(e)>=c*u;v||t<=60&&Math.abs(e)>=30&&(v=!0);let h=a;v&&(h=e>0?a-1:a+1,h<0?h=i?l-1:0:h>=l&&(h=i?0:l-1));h===r&&(o=1);let f=u*h*-1;if(i){if(n)return void function(e,t,n,a){const i=d.duration.value,l=g(e,t,n);let r=0;t===n&&(r=1);animation.transition(m.el,{styles:{opacity:`${r}`},duration:0,delay:0,timingFunction:d.timingFunction.value||"ease",needLayout:!1},(e=>{animation.transition(m.el,{styles:{transform:`translateX(${l}px) scale(${a})`,opacity:r},duration:i,delay:0,timingFunction:d.timingFunction.value||"ease",needLayout:!1},(e=>{d.inCurrent.value=t,d.inMoving.value=!1,0===r&&x(l,a),t===n&&d.emitChange(t)}))}))}(u,a,r,o);f=g(u,a,r),a!=h&&(f+=e>=0?u:-u)}animation.transition(m.el,{styles:{transform:`translateX(${f}px) scale(${o})`},duration:s,delay:0,timingFunction:d.timingFunction.value||"ease",needLayout:!1},(e=>{d.inCurrent.value=h,d.inMoving.value=!1,v&&i&&function(e,t,n,a){const i=d.scale.value;let l=!1;t===a-1&&0===n?l=!0:0===t&&n===a-1?l=!1:t<n&&(l=!0);if(l){let l=t-2;l+1<0&&(l=a-2),l<0&&(l=a-1);let r=n+2;return r-1>=a&&(r=1),r>=a&&(r=0),p.value===l&&animation.transition(m.el,{styles:{opacity:0,transform:`translateX(${5*e}px) scale(${i})`},duration:0,delay:0,needLayout:!1},(t=>{x(5*e,i)})),void(p.value===r&&animation.transition(m.el,{styles:{opacity:0,transform:`translateX(${-1*e*(r-2)}px) scale(${i})`},duration:0,delay:0,needLayout:!1},(t=>{x(-1*e*(r-2),i)})))}let r=t+2;r-1>=a&&(r=1);r>=a&&(r=0);let s=n-2;s+1<0&&(s=a-2);s<0&&(s=a-1);p.value===r&&animation.transition(m.el,{styles:{opacity:0,transform:`translateX(${5*e}px) scale(${i})`},duration:0,delay:0,needLayout:!1},(t=>{x(5*e,i)}));p.value===s&&animation.transition(m.el,{styles:{opacity:0,transform:`translateX(${-1*e*(s+2)}px) scale(${i})`},duration:0,delay:0,needLayout:!1},(t=>{x(-1*e*(s+2),i)}))}(u,a,h,l),v&&h===r&&d.emitChange(h)}))},toPosition:function(e,t,n){d.children.length;const a=p.value,i=n?0:d.duration.value,l=d.baseWidthPx.value;let r=d.scale.value;t===a&&(r=1);const s=l*t*-1;animation.transition(m.el,{styles:{transform:`translateX(${s}px) scale(${r})`},duration:i,delay:0,timingFunction:d.timingFunction.value||"ease",needLayout:!1},(e=>{d.inCurrent.value=t,d.inMoving.value=!1,t===a&&d.emitChange(t)}))}});const h=n((()=>{let e="",t=d.leftPx.value+d.spacePx.value*p.value+d.itemWidthPx.value*p.value;return d.center.value&&(t=.5*(d.widthPx.value-d.itemWidthPx.value)+d.spacePx.value*p.value+d.itemWidthPx.value*p.value),e+=`left:${t}px;width:${d.itemWidthPx.value}px;;height:${d.itemHeightPx.value}px;`,e}));function x(e,t){animation.transition(m.el,{styles:{transform:`translateX(${e}px) scale(${t})`,opacity:1},duration:0,delay:0,timingFunction:d.timingFunction.value||"ease",needLayout:!1},(e=>{}))}function g(e,t,n,a){const i=d.children.length;let l=e*t*-1,r=t-1,s=t-2;r<0&&(r=i-1,s=i-2),s<0&&(s=i-1);let u=t+1,o=t+2;if(u>=i&&(u=0,o=1),o>=i&&(o=0),n===r)l=e*(r+1)*-1;else if(n===u)l=e*(u-1)*-1;else if(n===s)l=e*(s+2)*-1;else if(n===o)l=e*(o-2)*-1;else if(n!=t){if(a)return"";l=5*e}return l}return(e,t)=>{const n=u;return o(),a(n,{ref:e=>l(m).set(e),class:r(["n-position-absolute","n-bg-"+e.bgType,"n-border-"+e.border,"n-radius-"+e.radius,"n-flex-"+e.flex,"n-align-"+e.align,"n-justify-"+e.justify,e.boxClass]),style:s(h.value+e.boxStyle)},{default:i((()=>[c(e.$slots,"default")])),_:3},8,["class","style"])}}},$={__name:"n-swiper",props:x([["linkage",null,Object],["width","750rpx"],["height","360rpx"],["itemWidth","600rpx"],["itemHeight","360rpx"],["left","0"],["right","0"],["space","64rpx"],["lock",!1],["current",0],["autoPlay",!1],["interval",2e3],["circular",!1],["center",!1],["scale",.62],["percent",.4],["duration",300],["silence",!1],["baseWidth","0"],["times",1.5],["linear",!0],["timingFunction","ease-in-out"],["updateTime",0],"boxStyle","boxClass"]),emits:["change"],setup(e,{expose:x,emit:y}){const $=e,b=y;let P=null;const w=[],W=t(0),C=t(!1),X=t(null),{linkage:j,lock:F,center:T,duration:k,linear:E,circular:M,scale:L,percent:S,timingFunction:_}=v($),H=f(),A=n((()=>g($.left)));n((()=>g($.right)));const I=n((()=>g($.space))),D=n((()=>g($.width))),K=n((()=>g($.height))),N=n((()=>g($.itemWidth))),O=n((()=>g($.itemHeight))),z=n((()=>`width:${D.value}px;height:${K.value}px;`)),J=n((()=>$.baseWidth&&0!=$.baseWidth?g($.baseWidth):N.value+I.value)),q=n((()=>J.value*$.times));function B(e,t,n=!1){const a=w.length;if(0===a)return;let i=t;t>=a&&(i=a-1),C.value=!0,w.forEach((t=>{t.toPosition(e,i,n)}))}function G(e=0,t=1e3,n){const a=w.length;0!==a&&(W.value>=a&&(W.value=a-1),C.value=!0,w.forEach((a=>{a.toAdjust(e,t,n)})))}function Q(e){if(C.value||$.lock)return;X.value&&clearInterval(X.value),X.value=null,C.value=!0;let t=[];const n=W.value;w.forEach((e=>{t.push({element:e.nswiperitem.el.ref,property:"transform.scale",expression:e.getScaleExp(n)}),t.push({element:e.nswiperitem.el.ref,property:"transform.translateX",expression:e.getExp(n)})}));let a=1;j.value&&(a=j.value.itemWidthPx/N.value,t=t.concat(function(e){if(j.value.inMoving||j.value.lock)return;j.value.playTimer&&clearInterval(j.value.playTimer),j.value.playTimer=null,j.value.inMoving=!0;const t=[],n=j.value.inCurrent;return j.value.children.forEach((a=>{t.push({element:a.nswiperitem.el.ref,property:"transform.scale",expression:a.getScaleExp(n,e)}),t.push({element:a.nswiperitem.el.ref,property:"transform.translateX",expression:a.getExp(n,e)})})),t}(a)));const i=Date.now(),l=bindingX.bind({eventType:"pan",anchor:H.el.ref,props:t},(e=>{const t=Date.now();"end"==e.state&&(G(e.deltaX,t-i),j.value&&j.value.toAdjust(e.deltaX*a,t-i),bindingX.unbind({eventType:"pan",token:P}),P=0)}));P=l.token}return x({inMoving:C,inCurrent:W,children:w,lock:F,playTimer:X,itemWidthPx:N,toAdjust:G,toPrev:function(){G(50,40)},toNext:function(){G(-50,40)}}),d("nSwiper",{children:w,inMoving:C,inCurrent:W,center:T,duration:k,linear:E,circular:M,scale:L,percent:S,timingFunction:_,leftPx:A,spacePx:I,widthPx:D,itemWidthPx:N,itemHeightPx:O,baseWidthPx:J,maxX:q,pushChild:function(e){w.push(e)},emitChange:function(e){b("change",e)}}),p((()=>{if(w.length>0){if($.current>=w.length?W.value=w.length-1:W.value=$.current,$.circular)return void G(0,1e3,!0);B(W.value,$.current,$.silence)}})),m((()=>$.updateTime),(()=>{$.circular?G(0,1e3,!0):B(W.value,$.current,$.silence)})),m(C,(e=>{!e&&$.autoPlay&&$.circular&&(X.value&&clearInterval(X.value),X.value=setInterval((()=>{G(-50,40)}),$.interval))})),m((()=>$.current),(e=>{0!=w.length&&(e==W.value||$.circular||B(W.value,e))})),h((()=>{P&&(bindingX.unbind({eventType:"pan",token:P}),P=0)})),(e,t)=>{const n=u;return o(),a(n,{ref:e=>l(H).set(e),class:r(["n-position-relative","n-overflow-hidden",e.boxClass]),style:s(z.value+e.boxStyle),onHorizontalpan:Q},{default:i((()=>[c(e.$slots,"default")])),_:3},8,["class","style"])}}};export{y as _,$ as a};
