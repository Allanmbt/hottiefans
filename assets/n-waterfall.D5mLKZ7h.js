import{r as e,d as l,w as o,n as r,m as t,i as s,o as n,e as a,N as i,E as u,c as h,b as c,j as f,G as d,f as p}from"./index-DyB-GtSf.js";import{m as g}from"./props.CkprGx8I.js";import{u as x,a as m,_ as T,b,c as v}from"./usePager.Bx7XEHLh.js";import{r as y}from"./uni-app.es.CYr7Wecl.js";import{g as S,b as w}from"./system.Bdz65IDa.js";const C={__name:"n-waterfall-view",props:g([["idLabel","id"],["sameHeight",!1],["calculator",null,Function],["columnGap","0"],["leftGap","0"],["rightGap","0"],"boxStyle","boxClass"]),setup(u,{expose:h}){h({set:function(e){m(e)},concat:function(e){m(e)},remove:function(e){let l=d.value.findIndex((e=>{e[c.idLabel]}));if(l>=0){d.value.splice(l,1);const o=g.value-(f.value["i_"+e]||0);return delete f.value["i_"+e],void(g.value=o>=0?o:0)}if(l=p.value.findIndex((e=>{e[c.idLabel]})),l>=0){p.value.splice(l,1);const o=x.value-(f.value["i_"+e]||0);delete f.value["i_"+e],x.value=o>=0?o:0}},modify:function(e,l,o){let r=d.value.findIndex((e=>{e[c.idLabel]}));if(r>=0){return void(d.value[r][l]=o)}r=p.value.findIndex((e=>{e[c.idLabel]})),r>=0&&(p.value[r][l]=o)},clear:function(){d.value=[],p.value=[],g.value=0,x.value=0},clearCache:function(e){if(void 0===e)return void delete f.value["i_"+e];f.value={}}});const c=u,f=e({}),d=e([]),p=e([]),g=e(0),x=e(0);async function m(e){if(0!==e.length)if(!c.sameHeight&&c.calculator)for(const l in e){const o=e[l],r=o[c.idLabel];let t=0;const s=f.value["i_"+r];if(s&&0!==s.h)t=s.h,o.mH=t,o.m={...s};else{const e=c.calculator(o);t=e.h,f.value["i_"+r]=e,o.mH=t,o.m={...e}}g.value<=x.value?(d.value.push(o),g.value+=t):(p.value.push(o),x.value+=t)}else for(const l in e)d.value.length<=p.value.length?d.value.push(e[l]):p.value.push(e[l])}return(e,u)=>{const h=s;return n(),l(h,{class:r(["n-flex-row","n-wrap-nowrap",e.boxClass]),style:t(e.boxStyle)},{default:o((()=>[a(h,{class:"n-shrink-0",style:t({width:e.leftGap})},null,8,["style"]),a(h,{class:"n-flex-column n-flex-1"},{default:o((()=>[i(e.$slots,"left",{lefts:d.value})])),_:3}),a(h,{class:"n-shrink-0",style:t({width:e.columnGap})},null,8,["style"]),a(h,{class:"n-flex-column n-flex-1"},{default:o((()=>[i(e.$slots,"right",{rights:p.value})])),_:3}),a(h,{class:"n-shrink-0",style:t({width:e.rightGap})},null,8,["style"])])),_:3},8,["class","style"])}}},R={__name:"n-waterfall",props:g([["enableBackToTop",!1],["useLoading",!1],["loadMoreOffset",60],["columnCount","auto",[String,Number]],["columnWidth","auto"],["columnGap","0"],["leftGap","0"],["rightGap","0"],["autoUpdate",!1],["down",{use:!0,offset:u(140),inRate:.8,outRate:.2}],["up",{use:!0,offset:80}],["showScrollbar",!0],["bgType","page"],["position","static"],["top","0"],["bottom","0"],"boxStyle",["height","window-!status-!nav"],"reverse",["loadMainText","继续加载更多"],["loadingText","正在加载"],["noMoreText","没有更多啦"],["showNoMore",!0],["loadingSrc","/static/ui/loading-small.gif"],"loadingStyle","loadingImgStyle","loadingTextStyle",["refreshMainText","下拉即可刷新..."],["pullingText","释放即可刷新..."],["refreshingText","正在努力加载..."],"refreshStyle","refreshTextStyle","boxClass","loadingClass","loadingImgClass","loadingTextClass","refreshClass","refreshTextClass",["upperThreshold",50],["lowerThreshold",50],["scrollWithAnimation",!0],["refresherEnabled",!1],["refresherThreshold",45],["refresherDefaultStyle","black"],["refresherBackground","#FFFFFF"],["refresherTriggered",!1],["enableFlex",!1],["scrollAnchoring",!1]]),emits:["inited","scroll","down","up","upper","lower","pulling","refresh","restore","abort"],setup(g,{expose:C,emit:R}){const _=g,L=R,M=e(null),k=e(null),G=e(null),{nCurrentView:E,nScrollTop:F,nScrollTo:I,nScrollToTop:j,nScrollToBottom:H}=x(),{pagerState:N,nInitContentList:B,nScroll:U,nLoad:$,nReload:A,nRefresh:W,nEndSuccess:D,nEndError:O,nTouchstartEvent:P,nTouchmoveEvent:Y,nTouchendEvent:q}=m(_,L,M,k,G,E),{onScrollToUpper:K,onScrollToLower:V,onRefresherPulling:z,onRefresherRefresh:J,onRefresherRestore:Q,onRefresherAbort:X}=v(L);C({nLoad:$,nReload:A,nRefresh:W,nEndSuccess:D,nEndError:O,nScrollTo:I,nScrollToTop:j,nScrollToBottom:H});const Z=h((()=>{let e="";return"-1"!=_.height&&(e+="height:"+S(_.height)+"px;"),"-1"!=_.top&&(e+="top:"+S(_.top)+"px;"),"-1"!=_.bottom&&(e+="bottom:"+S(_.bottom)+"px;"),e+_.boxStyle})),ee=h((()=>{let e="position: relative;";return e+=N.isDownReset?"transition-property: transform; transition-duration: 300ms;":"",e+=N.downHeight>0?`transform: translateY(${N.downHeight}px);`:"",e})),le=h((()=>"position: absolute; transform: translateY(-100%); left:0;")),oe=h((()=>N.downHeight>=(N.down.offset||80))),re=h((()=>N.downHeight/(N.down.offset||80)));return h((()=>"auto"===_.columnWidth?"auto":w(_.columnWidth))),h((()=>w(_.columnGap))),h((()=>w(_.leftGap))),h((()=>w(_.rightGap))),N.down=Object.assign({use:!0,offset:u(140),inRate:.8,outRate:.2},_.down||{use:!1}),N.up=Object.assign({use:!0,offset:80},_.up||{use:!1}),setTimeout((()=>{L("inited")}),0),_.autoUpdate&&setTimeout((()=>{B()}),10),(e,u)=>{const h=y(c("n-refresher"),T),g=s,x=y(c("n-loader"),b),m=d;return n(),l(m,{class:r(["n-bg-"+e.bgType,e.boxClass]),style:t(Z.value),"upper-threshold":e.upperThreshold,"lower-threshold":e.lowerThreshold,"scroll-into-view":f(E),"scroll-top":f(F),"scroll-with-animation":e.scrollWithAnimation,"scroll-y":f(N).scrollable,"show-scrollbar":e.showScrollbar,"enable-back-to-top":e.enableBackToTop,"refresher-enabled":e.refresherEnabled,"refresher-threshold":e.refresherThreshold,"refresher-default-style":e.refresherDefaultStyle,"refresher-background":e.refresherBackground,"refresher-triggered":e.refresherTriggered,"enable-flex":e.enableFlex,"scroll-anchoring":e.scrollAnchoring,onScroll:f(U),onTouchstart:f(P),onTouchmove:f(Y),onTouchend:f(q),onTouchcancel:f(q),onScrolltoupper:f(K),onScrolltolower:f(V),onRefresherpulling:f(z),onRefresherrefresh:f(J),onRefresherrestore:f(Q),onRefresherabort:f(X)},{default:o((()=>[a(g,{style:t(ee.value)},{default:o((()=>[f(N).down.use?(n(),l(g,{key:0,style:t(le.value)},{default:o((()=>[a(h,{refreshing:f(N).isDownLoading,couldUnLash:oe.value,rate:re.value,mainText:e.refreshMainText,pullingText:e.pullingText,refreshingText:e.refreshingText,boxStyle:e.refreshStyle,textStyle:e.refreshTextStyle,boxClass:e.refreshClass,textClass:e.refreshTextClass},null,8,["refreshing","couldUnLash","rate","mainText","pullingText","refreshingText","boxStyle","textStyle","boxClass","textClass"])])),_:1},8,["style"])):p("",!0),a(g,{id:"n-list-top",ref:"n-list-top"},null,512),i(e.$slots,"header"),i(e.$slots,"default"),i(e.$slots,"footer"),a(g,{id:"n-list-bottom",ref:"n-list-bottom"},null,512),f(N).up.use?(n(),l(x,{key:1,isLoading:f(N).isUpLoading,hasMore:f(N).hasMore,showNoMore:e.showNoMore,mainText:e.loadMainText,loadingText:e.loadingText,noMoreText:e.noMoreText,loadingSrc:e.loadingSrc,boxStyle:e.loadingStyle,imgStyle:e.loadingImgStyle,textStyle:e.loadingTextStyle,boxClass:e.loadingClass,imgClass:e.loadingImgClass,textClass:e.loadingTextClass},null,8,["isLoading","hasMore","showNoMore","mainText","loadingText","noMoreText","loadingSrc","boxStyle","imgStyle","textStyle","boxClass","imgClass","textClass"])):p("",!0)])),_:3},8,["style"])])),_:3},8,["class","style","upper-threshold","lower-threshold","scroll-into-view","scroll-top","scroll-with-animation","scroll-y","show-scrollbar","enable-back-to-top","refresher-enabled","refresher-threshold","refresher-default-style","refresher-background","refresher-triggered","enable-flex","scroll-anchoring","onScroll","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onScrolltoupper","onScrolltolower","onRefresherpulling","onRefresherrefresh","onRefresherrestore","onRefresherabort"])}}};export{C as _,R as a};
